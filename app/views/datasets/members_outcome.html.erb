<style>
  .members-outcome-heading {
    color: #33333C;
    font-weight: 600;
    margin-bottom: 20px;
  }

  .members-outcome-card {
    background-color: #041F3A;
  }

  .members-outcome-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .members-outcome-table th {
    color: #EF4E50;
    font-weight: bold;
    font-size: 14px;
    border-bottom: 2px solid #EF4E50;
    padding: 12px 8px;
    background-color: #041F3A;
  }

  .members-outcome-table td {
    color: #FFFFFF;
    font-size: 14px;
    padding: 10px 8px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .members-outcome-table tbody tr:hover {
    background-color: rgba(255, 255, 255, 0.05);
  }
</style>



<div class="b-container">
 
<% if @myQuery.present? %>
  <div class="row">
    <div class="col s12 m5">
      <div class="row">
        <div class="col m4 s12 right">
        <div class="right col s9">
          <div class="right valign-wrapper paletton-red-text">

            <a href="/datasets/members_search"><i class="material-icons paletton-red-text right-extra-margin">arrow_back</i></a>
            <a id="freq-download-trigger" class="dropdown-trigger" href='#' data-target='files-dropdown' href=""><i class="material-icons paletton-red-text right-extra-margin">download</i></a>
            <ul id='files-dropdown' class='dropdown-content'>
                <li class="dropdown-item">
                  <a><%= image_tag "pdf_icon.png", :class => "center small-icon-size" %></a>
                </li>
            </ul>
            <a href="#freq-help-modal-2" class="modal-trigger"><i class="material-icons paletton-red-text right-extra-margin">help_outline</i></a>
          </div>
        </div>
        </div>  
      </div>
      <div class="card z-depth-1" style="background-color: white; margin-bottom: 30px">
        <div class="card-content" style="color: #33333C;">
          <table class="striped responsive-table" style="font-size: 14px;">
            <tbody>
              <tr>
                <td colspan="2" style="font-weight: bold; padding-bottom: 15px; color: #EF4E50">
                  PARÁMETROS DE CONSULTA
                </td>
              </tr>
              <tr>
                <th>ID:</th>
                <td><%= @myQuery.organization.id %>-<%= @myQuery.id %></td>
              </tr>
              <tr>
                <th>Fecha y hora:</th>
                <td><%= @myQuery.created_at.strftime("%d/%m/%Y %H:%M") %></td>
              </tr>
              <tr>
                <th>Nombre(s):</th>
                <td><%= @myQuery.firstname %></td>
              </tr>
              <tr>
                <th>Apellido Paterno:</th>
                <td><%= @myQuery.lastname1 %></td>
              </tr>
              <tr>
                <th>Apellido Materno:</th>
                <td><%= @myQuery.lastname2 %></td>
              </tr>
    <tr>
      <tr>
        <th>Registros analizados:</th>
        <td><%= @myQuery.search %></td>
      </tr>
      <th>Probabilidad de homónimos:</th>
      <td>
        <% homonimo_label =
          case @myQuery.homo_score
          when 0...2 then "Baja"
          when 2...5 then "Media"
          when 5..10 then "Alta"
          else "Muy alta"
          end
        %>
        <%= homonimo_label %>
      </td>
    </tr>
    <tr>
      <td colspan="2" style="padding-top: 10px;">
        <% estimacion =
          case @myQuery.homo_score
          when 0...2 then "sólo 1"
          when 2...3 then "más de 2"
          when 3...4 then "más de 3"
          when 4...5 then "más de 4"
          when 5...6 then "más de 5"
          when 6...7 then "más de 6"
          when 7...8 then "más de 7"
          when 8...9 then "más de 8"
          when 9...10 then "más de 9"
          when 10...20 then "más de 10"
          when 20...30 then "más de 20"
          when 30...40 then "más de 30"
          when 40...50 then "más de 40"
          when 50...60 then "más de 50"
          when 60...70 then "más de 60"
          when 70...80 then "más de 70"
          when 80...90 then "más de 80"
          when 90...100 then "más de 90"
          when 100...200 then "más de 100"
          when 200...500 then "más de 200"
          when 500...1000 then "más de 500"
          else "más de 1000"
          end
        %>
        Se estima que hay <%= estimacion %> mexicano(s) adulto(s) con el nombre y apellidos consultados o alguna de sus variantes.
      </td>
      </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
<% end %>

  <div class="row">
    <div class="col s12">
      <h5 class="members-outcome-heading">Miembros vinculados con al menos un hit</h5>

      <div class="card z-depth-1 members-outcome-card">
        <div class="card-content">
          <table class="highlight responsive-table members-outcome-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nombres</th>
                <th>Apellido Paterno</th>
                <th>Apellido Materno</th>
                <th>Alias</th>
                <th>Rol</th>
                <th>Organización</th>
                <th>Último registro</th>
                <th>Lugar</th>
              </tr>
            </thead>
            <tbody>
              <% @keyMembers.each do |member| %>
                <tr>
                  <td><%= member.id %></td>
                  <td><%= member.firstname %></td>
                  <td><%= member.lastname1 %></td>
                  <td><%= member.lastname2 %></td>
                  <td><%= member.alias.first %></td>
                  <td><%= member.role&.name %></td>
                  <td><%= member.organization&.name %></td>
                  <td><%= member.hits.last&.date&.strftime('%d/%m/%y') %></td>
                  <td>
                    <% if member.hits.last&.town&.county&.name.present? && member.hits.last.town.county.name != "Sin definir" %>
                      <%= member.hits.last.town.county.name %>,
                    <% end %>
                    <%= member.hits.last&.town&.county&.state&.shortname %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>