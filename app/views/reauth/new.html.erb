<%= render 'shared/flash' %>

<div class="row">
  <br>
  <div class="col l5 m8 s12">
    <div class="card paletton-grey">
      <div class="card-content white-text">
        <div class="row">
          <div class="col s12">
            <%= render "shared/lantialogo2" %>
          </div>
        </div>

        <div class="row">
          <div class="col s12">
            <span class="card-title center">Verificación de seguridad</span>
          </div>
        </div>

        <form action="/reauth" method="post">
          <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">

          <div class="row">
            <div class="col s12 valign-wrapper">
              <i class="material-icons prefix small">vpn_key</i>
              <input class="input-padding white" id="reauth-password" name="password" type="password" placeholder="Contraseña" required minlength="7">
              <i class="material-icons grey-text text-darken-2"
                 id="toggle-pass"
                 style="margin-left: -40px; cursor: pointer;">visibility</i>
            </div>
          </div>

          <div class="row">
            <div class="col s12">
              <div class="input-field valign-wrapper right short-row" style="margin-right: 70px;">
                <button class="btn-floating teal lighten-5" type="submit">
                  <i class="material-icons grey-text text-darken-3">send</i>
                </button>
              </div>
            </div>
          </div>
        </form>

      </div> <!-- /.card-content -->
    </div>   <!-- /.card -->
  </div>
</div>

<script nonce="<%= csp_nonce %>">
  function togglePasswordVisibility(e) {
    var passwordField = document.getElementById('reauth-password'); // <-- id correcto
    var icon = e && (e.currentTarget || e.target);
    if (!passwordField || !icon) return;

    if (passwordField.type === 'password') {
      passwordField.type = 'text';
      icon.textContent = 'visibility_off';
    } else {
      passwordField.type = 'password';
      icon.textContent = 'visibility';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    try { if (window.M && M.Modal) M.Modal.init(document.querySelectorAll('.modal')); } catch(e) {}

    // Enlazar el click al ícono
    var toggle = document.getElementById('toggle-pass');
    if (toggle) toggle.addEventListener('click', togglePasswordVisibility);
  });
</script>
