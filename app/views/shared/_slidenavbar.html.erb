<script type="text/javascript" nonce="<%= csp_nonce %>">
</script>

<% u   = User.find_by(id: session[:user_id]) %>
<% org = u&.member&.organization %>

<% show_panel  = (org&.search_panel == true) %>
<% data_access = (org.nil? ? true : (org.data_access == true)) %>

<% panel_only = (show_panel && !data_access) %>

<div class="side-icon red-text text-accent-4">
  <ul id="slide-out" class="sidenav paletton-grey
      <% if @intro %>
        animate__animated animate__slideInLeft animate__delay-1s
      <% end %>
    "
    <% if @intro %>
      style="transform: translateX(0%)"
    <% end %>
  >
    <li>
      <div class="user-view background paletton-grey"></div>
    </li>

    <div id="user-links white-text" class="paletton-red">
      <br>

      <li class="white-text p20 semi-slim">
        <a class="left-min-margin p20 semi-slim preloader-trigger" href="/frontpage">
          <i class="material-icons white-text left-extra-margin">home</i>
        </a>
        <a class="left-min-margin p20 semi-slim preloader-trigger" href="/organizations/logout">
          <i class="material-icons white-text left-extra-margin tooltipped" data-tooltip="Cerrar sesión">power_settings_new</i>
        </a>
      </li>

      <% if admin_user? %>
        <li style="padding:0; margin:0;">
          <ul class="collapsible" style="margin:0; border:0; box-shadow:none;">
            <li>
              <div class="left-extra-margin collapsible-header paletton-red white-text p20 semi-slim"
                   style="border:0; padding: 0 18px; min-height:56px; line-height:56px;">
                <span style="display:inline-block;">ADMIN</span>
                <i class="material-icons white-text" style="margin-left:auto;">expand_more</i>
              </div>

              <div class="collapsible-body paletton-red"
                   style="border:0; padding:0; background: inherit;">
                <ul style="margin:0; padding:0;">
                  <li>
                    <a class="white-text p20 semi-slim preloader-trigger"
                       style="display:block; padding: 12px 18px;"
                       href="/users/admin">Ver usuarios</a>
                  </li>
                  <li>
                    <a class="white-text p20 semi-slim preloader-trigger"
                       style="display:block; padding: 12px 18px;"
                       href="/users/edit">Editar usuarios</a>
                  </li>
                  <li>
                    <a class="white-text p20 semi-slim preloader-trigger"
                       style="display:block; padding: 12px 18px;"
                       href="/users/new">Crear usuarios</a>
                  </li>
                  <li>
                    <a class="white-text p20 semi-slim preloader-trigger"
                       style="display:block; padding: 12px 18px;"
                       href="/organizations/admin">Organizaciones</a>
                  </li>
                  <li>
                    <a class="white-text p20 semi-slim preloader-trigger"
                       style="display:block; padding: 12px 18px;"
                       href="/datasets/easy_hits">Agregar hits</a>
                  </li>
                </ul>
              </div>
            </li>
          </ul>
        </li>
        <div class="divider"></div>
        <br>
      <% end %>

      <%# PANEL (siempre que la org tenga search_panel) %>
      <% if show_panel %>
        <li>
          <a class="left-min-margin white-text p20 semi-slim preloader-trigger" href="/datasets/members_search">
            PANEL DE CONSULTA
          </a>
        </li>
        <div class="divider"></div>
        <br>
      <% end %>

      <%# =========================
          %> <%# MÓDULOS "DATA" (solo si data_access) %>
      <%# ========================= %>
      <% unless panel_only %>

        <% if u && u.victim_access == false %>
          <li class="paletton-light-red-text p20 semi-slim">
            <i class="material-icons tiny left-extra-margin">lock</i><span class="left-min-margin">VÍCTIMAS</span>
          </li>
        <% else %>
          <li><a class="left-min-margin white-text p20 semi-slim preloader-trigger" href="/victims/new_query">VÍCTIMAS</a></li>
        <% end %>

        <% if u && u.organization_access == false %>
          <li class="paletton-light-red-text p20 semi-slim">
            <i class="material-icons tiny left-extra-margin">lock</i><span class="left-min-margin">ORGANIZACIONES</span>
          </li>
        <% else %>
          <li><a class="left-min-margin white-text p20 semi-slim preloader-trigger" href="/organizations/query">ORGANIZACIONES</a></li>
        <% end %>

        <% if session[:membership].to_i > 3 %>
          <% if u && u.detention_access == false %>
            <li class="paletton-light-red-text p20 semi-slim">
              <i class="material-icons tiny left-extra-margin">lock</i><span class="left-min-margin">ARRESTOS</span>
            </li>
          <% else %>
            <li><a class="left-min-margin white-text p20 semi-slim preloader-trigger" href="/members/new_query">ARRESTOS</a></li>
          <% end %>
        <% end %>

        <br>
        <div class="divider"></div>
        <br>

        <% if u && u.irco_access == false %>
          <li class="paletton-light-red-text p20 semi-slim">
            <i class="material-icons tiny left-extra-margin">lock</i><span class="left-min-margin">IRCO</span>
          </li>
        <% else %>
          <li><a class="left-min-margin white-text p20 semi-slim tooltipped preloader-trigger" data-tooltip="Índice de Riesgo por Crimen Organizado" href="/states/irco">IRCO</a></li>
        <% end %>

        <% if session[:membership].to_i > 1 %>
          <% if u && u.icon_access == false %>
            <li class="paletton-light-red-text p20 semi-slim">
              <i class="material-icons tiny left-extra-margin">lock</i><span class="left-min-margin">ICON</span>
            </li>
          <% else %>
            <li><a class="left-min-margin white-text p20 semi-slim tooltipped preloader-trigger" data-tooltip="Índice de Conflictividad" href="/states/icon">ICON</a></li>
          <% end %>
        <% end %>

        <br>

        <% if session[:membership].to_i > 3 %>
          <div class="divider"></div>
          <br>
          <li><a class="left-min-margin white-text p20 semi-slim" href="/datasets/downloads" target="_blank">ARCHIVO LANTIA</a></li>
          <li><a class="left-min-margin white-text p20 semi-slim" href="/guide_4.pdf" target="_blank">MANUAL</a></li>
          <br>
        <% end %>

      <% end %> <%# /unless panel_only %>

      <li></li>
    </div>
  </ul>

  <div class="col s2">
    <a href="#" data-target="slide-out" class="sidenav-trigger">
      <i class="material-icons small paletton-red-text class">menu</i>
    </a>
  </div>
</div>