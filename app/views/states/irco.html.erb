5522131068
<% provide :head_tags do %>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
	<script type="text/javascript">
		$(document).ready(function() {		
			
			// MAP
			google.charts.load('current', {
				'packages':['geochart'],
				'mapsApiKey': '<%= @key %>'
			});

			function drawRegionsMap() {
				var data = google.visualization.arrayToDataTable([
					['State', 'IRCO'],
					<% @sortedTable.each do |row| %>
						[
							<% if row[:state].name == "Ciudad de México" %>
								"Distrito Federal"
							<% else %>
								'<%= row[:state].name %>'
							<% end %>
							,
							<%= number_with_precision(row[:irco][:score],precision:2) %>
						],
					<% end %>
				]);
				var options = {
					height: 580,
					region: 'MX',
					resolution: 'provinces',
					colorAxis: {
						values: [0,4,4.00001,5,5.00001,6.5,6.50001,10],
						colors: ['#aed581','#aed581','#fff176','#fff176','#ffb74d','#ffb74d','#ff8a65','#ff8a65']
						// MEDIUM colors: ['#9ccc65','#9ccc65','#ffee58','#ffee58','#ffa726','#ffa726','#ef5350','#ef5350']
						// DARKER colors: ['#8bc34a','#8bc34a','#ffeb3b','#ffeb3b','#ff9800','#ff9800','#f44336','#f44336']
					},
					legend: false,
				};
				var chart = new google.visualization.GeoChart(document.getElementById('map-display'));
				chart.draw(data, options);
			}
			google.charts.setOnLoadCallback(drawRegionsMap)
			
			
			// CHART
			google.charts.load('current', {'packages':['corechart']
			});

			<% @sortedTable.each do |row| %>
				$('#index-<%= row[:state].id %>-list-trigger').click(function() {
					$('.index-<%= row[:state].id %>-modal-section').hide();
					$('#<%= row[:state].id %>-irco-list').show();
					return false
				})

				$('#index-<%= row[:state].id %>-trend-trigger').click(function() {
					$('.index-<%= row[:state].id %>-modal-section').hide();
					$('#<%= row[:state].id %>-irco-trend').show();
					google.charts.setOnLoadCallback(drawLineChart<%= row[:state].id %>);
					return false
				});
				
				function drawLineChart<%= row[:state].id %>() {
					var data = google.visualization.arrayToDataTable([
						['Trimestre','IRCO'],
							<% row[:evolution_score].each do |q| %>
								['<%= q[:string] %>',<%= q[:score] %>],
							<% end %>
					]);
					var options = {
						height: 360,
						width: 680,
						legend: { position: "none" },
						animation: { "startup": true },
						series: {
							0: { 
								color: '<%= row[:hex] %>',
								lineWidth: 3,
							},
						},
						pointSize: 10,
						pointShape: 'circle',
						hAxis: {
							textStyle: { fontSize: 12 }
						},
						vAxis: {
							textStyle: { fontSize: 12 }	
						}
					};
					var chart = new google.visualization.LineChart(document.getElementById('<%= row[:state].id %>-irco-trend'));
					chart.draw(data, options);
				};
				
				$('#index-<%= row[:state].id %>-column-trigger').click(function() {
					$('.index-<%= row[:state].id %>-modal-section').hide();
					$('#<%= row[:state].id %>-irco-column').show();
					google.charts.setOnLoadCallback(drawColumnChart<%= row[:state].id %>);
					return false
				});

				function drawColumnChart<%= row[:state].id%>() {
					var data = google.visualization.arrayToDataTable([
						['Estado', 'IRCO', {role: 'style'}],
						['<%= row[:state].shortname %>', <%= row[:irco][:score] %>, '<%= row[:hex] %>'],
						<% row[:comparisonArr].each do |c| %>	
							['<%= c[:state].shortname %>', <%= c[:score] %>, '#bdbdbd'],	
						<% end %>
					]);
					var options = {
						height: 360,
						width: 680,
						legend: { position: "none" },
						animation: { "startup": true },
						hAxis: {
							textStyle: { fontSize: 12 }
						},
						vAxis: {
							textStyle: { fontSize: 12 },
							baseline: 0,

						}
					};
					var chart = new google.visualization.ColumnChart(document.getElementById('<%= row[:state].id %>-irco-column'));
					chart.draw(data, options);
				};
			<% end %>
		})				
	</script>
<% end %>

<div class="row top-row valign-wrapper">
	<div class="col s12">
		<div class="side-padding">
			<h5 class=" h5-no-margin">
				<span class="slim"> Índice de Riesgo por Crimen Organizado (IRCO)</span>
			</h5>
			<h5 class="h5-no-margin">
				<span id="irco-header" class="cyan-text text-accent-4"><%= @current_quarter_strings[:quarterText] %> de <%= I18n.l(@current_quarter_strings[:quarterDate], format: '%Y') %></span>
			</h5>
			<br>
			<% @levels.each do |level| %>
				<div class="category-tag right-extra-margin">
					<div class="valign-wrapper">
						<div class="pseudo-button valign-wrapper">
							<i class="material-icons right-min-margin <%= level[:color] %> <%= level[:color] %>-text z-depth-1">brightness_1</i>
						</div>
						<span><%= level[:name] %></span>
					</div>
				</div>
			<% end %>
		</div>
	</div>
</div>
<div class="row">
	<div class="col l5 m10 s12">
		<div id="index-dashboard">
			<div class="card cyan darken-1">
				<div class="card-content">
					<%= render "shared/indexswitch" %>
				</div>
			</div>
		</div>
		<div class="card grey lighten-4">
			<div class="card-content">
				<table id="irco_table" class="highlight center-align">
					<thead>
						<tr>
							<% @tableHeader.each do |head| %>
								<th class="center-align"><%= head %></th>
							<% end %>
						</tr>
					</thead>
					<tbody class="p16">
						<% @sortedTable.each do |row| %>
							<tr class="pseudo-clickable-row modal-trigger" href="#<%= row[:state].id %>-irco-modal">
								<td class="valign-wrapper">
									<div class="pseudo-button valign-wrapper">
										<i class="material-icons <%= row[:color] %> <%= row[:color] %>-text right-extra-margin z-depth-1">brightness_1</i>
									</div>
									<div class="county-tag">
										<p><%= row[:state][:name] %></p>
									</div>
								</td>
								<td class="right-align">#<%= row[:rank]%> </td>
								<td class="right-align"><%= number_with_precision(row[:irco][:score],precision:2) %></td>
								<td class="center-align"><%= row[:trend] %></td>
							</tr>
						<% end %>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<div class="col l7 m10 s12">		
		<div class="card">
				<div class="">
					<div id="map-display">
					</div>
				</div>	
		</div>
	</div>
</div>
<!-- MODAL SECTION -->
<% @sortedTable.each do |row| %>
	<div id="<%= row[:state].id %>-irco-modal" class="modal large-modal">
		<div class="modal-content">	
			<div class="row">
				<div class="col m4 s10 offset-s2">
					<%= image_tag "optimized_logo.jpg", :class => "modal-logo"%>
					<div class="valign-wrapper">
						<div class="pseudo-button valign-wrapper">
							<i class="material-icons small <%= row[:color] %> <%= row[:color] %>-text right-extra-margin z-depth-1">brightness_1</i>
						</div>
						<h5> <%= row[:state].name %><span class="slim"></span></h5>
					</div>
					<br>
					<p><span class="slim">IRCO: </span><%= row[:irco][:score] %></p>
					<p><span class="slim">Nivel: </span><%= row[:level] %></p>
					<p><span class="slim">Tendencia: </span><%= row[:trend] %></p>
					<br>
					<div class="divider"></div>
					<div class="stress-line valign-wrapper">
						<p><%= row[:rank] %><sup>a</sup> entidad federativa con mayor riesgo</p>
					</div>
					<div class="divider"></div>
					<br>
					<p><span class="slim left-large-margin">Población: </span><%= number_with_delimiter(row[:state].population) %></p>
					<% if row[:governor] %>
						<div id="governor-box" class="valign-wrapper">
							<%= image_tag(row[:governor].avatar, :class=> "tiny-thumb right-extra-margin z-depth-1 circle") %>
							<div>
								<p class="slim">Gobernador:</p>
								<p><span class="slim"></span><%= row[:governor].firstname+" "+row[:governor].lastname1+" "+row[:governor].lastname2 %></p>
							</div>
						</div>
					<% end %>
					<br>
				</div>
				<div class="col m7 s12">
					<div class="right col s9">
						<div class="row">
							<div class="right">
								<a id="index-<%= row[:state].id %>-list-trigger" href="javascript:void(0);"><i class="small material-icons cyan-text text-lighten-2 right-extra-margin">list</i></a>
								<a id="index-<%= row[:state].id %>-trend-trigger" href="javascript:void(0);"><i class="small material-icons cyan-text text-lighten-2 right-extra-margin index-trend-trigger">show_chart</i></a>
								<a id="index-<%= row[:state].id %>-column-trigger" href="javascript:void(0);"><i class="small material-icons cyan-text text-lighten-2 right-extra-margin">insert_chart</i></a>
							</div>
						</div>
					</div>
				</div>
				<div class="col m7 s12 index-<%= row[:state].id %>-modal-section" id="<%= row[:state].id %>-irco-list">
					<table class="left-extra-margin">
						<thead>
							<tr class="p12">
								<td class="center-align">INDICADOR</td>
								<td class="center-align"><%= @current_quarter_strings[:quarterShort] %>/<%= I18n.l(@current_quarter_strings[:quarterDate], format: '%Y') %></td>
								<td class="center-align">CAMBIO RESPECTO A <%= @back_one_q_strings[:quarterShort] %>/<%= I18n.l(@back_one_q_strings[:quarterDate], format: '%Y') %></td>
								<td class="center-align">CAMBIO RESPECTO A <%= @back_one_y_strings[:quarterShort] %>/<%= I18n.l(@back_one_y_strings[:quarterDate], format: '%Y') %></td>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td>Víctimas letales del crimen organizado</td>
								<td class="center-align p20">
									<%= number_with_delimiter(row[:irco][:victims]) %>
								</td>
								<td>
									<div class="valign-wrapper right">
										<i class="material-icons small <%= row[:q1_victims_change][:color]%>-text right-extra-margin"><%= row[:q1_victims_change][:icon] %></i>
										<%= row[:q1_victims_change][:variation] %>%
									</div>			
								</td>
								<td>
									<div class="valign-wrapper right">
										<i class="material-icons small <%= row[:y1_victims_change][:color]%>-text right-extra-margin"><%= row[:y1_victims_change][:icon] %></i>
										<%= row[:y1_victims_change][:variation] %>%
									</div>			
								</td>
							</tr>
							<tr>
								<td>Población que se siente insegura</td>
								<td class="center-align p20">
									<%= number_with_precision(row[:irco][:feel_safe], precision:1) %>%
								</td>
								<td class="">
									<div class="valign-wrapper right">
										<i class="material-icons small <%= row[:q1_feel_safe_change][:color]%>-text right-extra-margin"><%= row[:q1_feel_safe_change][:icon] %></i>
										<%= row[:q1_feel_safe_change][:variation]%>%
									</div>
								</td>
								<td class="center-align">
									<div class="valign-wrapper right">
										<i class="material-icons small <%= row[:y1_feel_safe_change][:color]%>-text right-extra-margin"><%= row[:y1_feel_safe_change][:icon] %></i>
										<%= row[:y1_feel_safe_change][:variation]%>%
									</div>
								</td>
							</tr>
							<tr>
								<td>Vehículos robados</td>
								<td class="center-align p20">
									<%= number_with_delimiter(row[:irco][:stolen_cars]) %>
								</td>
								<td>
									<div class="valign-wrapper right">
										<i class="material-icons small <%= row[:q1_stolen_cars_change][:color]%>-text right-extra-margin"><%= row[:q1_stolen_cars_change][:icon] %></i>
										<%= row[:q1_stolen_cars_change][:variation] %>%
									</div>			
								</td>
								<td>
									<div class="valign-wrapper right">
										<i class="material-icons small <%= row[:y1_stolen_cars_change][:color]%>-text right-extra-margin"><%= row[:y1_stolen_cars_change][:icon] %></i>
										<%= row[:y1_stolen_cars_change][:variation] %>%
									</div>			
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div id="<%= row[:state].id %>-irco-trend" class="index-<%= row[:state].id %>-modal-section col m7 s12 trend-chart-div">
				</div>
				<div id="<%= row[:state].id %>-irco-column" class="index-<%= row[:state].id %>-modal-section col m7 s12 column-chart-div">
				</div>
			</div>
		</div>
	</div>
<% end %>
